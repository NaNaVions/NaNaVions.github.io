from selenium import webdriver
from selenium.webdriver.common.by import By
import time
from pytest_check import check

PAGE_URL = "https://slqamsk.github.io/cases/pizza/v09/"


def test_titles():  #Проверка заголовка
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    with check:
        assert driver.title == "Пиццерия - Меню"
    with check:
        element = driver.find_element(By.XPATH, "//h1")
        assert element.text == "Пиццерия \"Итальянский уголок\""
    driver.quit()


def test_base_menu(): # Базовое меню
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Маргарита']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Четыре сыра']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Вегетарианская']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Пепперони']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Мясная']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Трюфельная']")
    with check:
        assert driver.find_element(By.XPATH, "//h3[.='Карбонара']")
    driver.quit()

def test_pizza_of_the_day(): #Проверка пиццы дня
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    element = driver.find_element(By.XPATH, "//h3[contains(., '(пицца дня)')]")
    with check:
        assert '(пицца дня)' in element.text
    with check:
        assert 'Маргарита' not in element.text
    with check:
        assert 'Четыре сыра' not in element.text
    with check:
        assert 'Вегетарианская' not in element.text
    driver.quit()

def test_adding_pizzas_to_cart():    #Добавление пицц в корзину
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    driver.find_element(By.XPATH, "//h3[.='Пепперони']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Четыре сыра']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Гавайская']/parent::*/button").click()
    time.sleep(2)
    # Переход в корзину
    driver.find_element(By.XPATH, "//a[@class='cart-link']").click()
    time.sleep(2)
    # Получить все элементы корзины
    cart_items = driver.find_elements(By.XPATH, "//div[@class='cart-item']")
    # Проверить наличие нужных пицц
    pizza_names = [item.find_element(By.TAG_NAME, "span").text for item in cart_items]
    assert any('Пепперони' in name for name in pizza_names)
    assert any('Четыре сыра' in name for name in pizza_names)
    assert any('Гавайская' in name for name in pizza_names)
    driver.quit()

def test_removing_pizzas_from_cart(): #Удаление пицц из корзины
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    # Добавляем пиццы в корзину
    driver.find_element(By.XPATH, "//h3[.='Пепперони']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Четыре сыра']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Гавайская']/parent::*/button").click()
    time.sleep(1)
    # Переход в корзину
    driver.find_element(By.XPATH, "//a[@class='cart-link']").click()
    time.sleep(2)
    driver.find_element(By.XPATH, "//button[@id='clear-cart']").click()
    time.sleep(2)
    driver.find_element(By.XPATH, "//button[@id='clear-cart']").click()
    cart_items = driver.find_elements(By.XPATH, "//div[@id='cart-items']/p[contains(text(), 'Корзина пуста')]")
    assert len(cart_items) > 0, "Корзина не пуста, элемент с сообщением отсутствует"
    driver.quit()

def test_placing_an_order(): # Оформление заказа
    driver = webdriver.Chrome()
    driver.get(PAGE_URL)
    # Добавляем пиццы в корзину
    driver.find_element(By.XPATH, "//h3[.='Пепперони']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Четыре сыра']/parent::*/button").click()
    driver.find_element(By.XPATH, "//h3[.='Гавайская']/parent::*/button").click()
    time.sleep(1)
    # Переход в корзину
    driver.find_element(By.XPATH, "//a[@class='cart-link']").click()
    time.sleep(2)
    # Оформить заказ
    driver.find_element(By.XPATH, "//button[@id='place-order']").click()
    time.sleep(2)
    driver.find_element(By.XPATH, "//input[@id='customer-name']").send_keys("Петрушкин Олег")
    driver.find_element(By.XPATH, "//input[@id='customer-email']").send_keys("PetruOl@mail.ru")
    driver.find_element(By.XPATH, "//button[@id='confirm-order']").click()
    time.sleep(2)
    driver.quit()

